include(FindPkgConfig)
if (HAVE_REVENGE)
	pkg_check_modules(LIBVISIO libvisio-0.1>=0.1)
	if (LIBVISIO_FOUND)
		message("Building MS-Visio Importer with librevenge")
		include_directories(${CMAKE_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/scribus ${LIBREVENGE_INCLUDE_DIRS} ${LIBREVENGE_GENERATORS_INCLUDE_DIRS} ${LIBREVENGE_STREAM_INCLUDE_DIRS} ${LIBVISIO_INCLUDE_DIRS})
		set(IMPORTVSD_PLUGIN_MOC_CLASSES importvsd.h importvsdplugin.h)
		set(IMPORTVSD_PLUGIN_SOURCES ../revenge/rawpainter.cpp importvsd.cpp importvsdplugin.cpp)
		set(SCRIBUS_IMPORTVSD_PLUGIN "importvsd")
		QT5_WRAP_CPP(IMPORTVSD_PLUGIN_MOC_SOURCES ${IMPORTVSD_PLUGIN_MOC_CLASSES})
		add_library(${SCRIBUS_IMPORTVSD_PLUGIN} MODULE ${IMPORTVSD_PLUGIN_SOURCES} ${IMPORTVSD_PLUGIN_MOC_SOURCES})
		target_link_libraries(${SCRIBUS_IMPORTVSD_PLUGIN} ${PLUGIN_LIBRARIES} ${LIBREVENGE_LDFLAGS} ${LIBREVENGE_GENERATORS_LDFLAGS} ${LIBREVENGE_STREAM_LDFLAGS} ${LIBVISIO_LDFLAGS})
		install(TARGETS ${SCRIBUS_IMPORTVSD_PLUGIN} LIBRARY DESTINATION ${PLUGINDIR} PERMISSIONS ${PLUGIN_PERMISSIONS})
		add_dependencies(${SCRIBUS_IMPORTVSD_PLUGIN} ${EXE_NAME})
	endif ()
else ()
	pkg_check_modules(LIBWPG libwpg-0.2)
	if (LIBWPG_FOUND)
		pkg_check_modules(LIBWPD libwpd-0.9)
		if (LIBWPD_FOUND)
			pkg_check_modules(LIBWPD_STREAM libwpd-stream-0.9)
			if (LIBWPD_STREAM_FOUND)
				pkg_check_modules(LIBVISIO libvisio-0.0<=0.1)
				if (LIBVISIO_FOUND)
					include_directories(${CMAKE_SOURCE_DIR} ${CMAKE_SOURCE_DIR}/scribus ${LIBWPG_INCLUDE_DIRS} ${LIBWPD_INCLUDE_DIRS} ${LIBWPD_STREAM_INCLUDE_DIRS} ${LIBVISIO_INCLUDE_DIRS})
					set(IMPORTVSD_PLUGIN_MOC_CLASSES importvsd.h importvsdplugin.h)
					set(IMPORTVSD_PLUGIN_SOURCES ../revenge/rawpainter.cpp importvsd.cpp importvsdplugin.cpp)
					set(SCRIBUS_IMPORTVSD_PLUGIN "importvsd")
					QT5_WRAP_CPP(IMPORTVSD_PLUGIN_MOC_SOURCES ${IMPORTVSD_PLUGIN_MOC_CLASSES})
					add_library(${SCRIBUS_IMPORTVSD_PLUGIN} MODULE ${IMPORTVSD_PLUGIN_SOURCES} ${IMPORTVSD_PLUGIN_MOC_SOURCES})
					target_link_libraries(${SCRIBUS_IMPORTVSD_PLUGIN} ${PLUGIN_LIBRARIES} ${LIBWPG_LDFLAGS} ${LIBWPD_LDFLAGS} ${LIBWPD_STREAM_LDFLAGS} ${LIBVISIO_LDFLAGS})
					install(TARGETS ${SCRIBUS_IMPORTVSD_PLUGIN} LIBRARY DESTINATION ${PLUGINDIR} PERMISSIONS ${PLUGIN_PERMISSIONS})
					add_dependencies(${SCRIBUS_IMPORTVSD_PLUGIN} ${EXE_NAME})
				endif ()
			endif ()
		endif ()
	endif ()
endif ()
